<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact - CasierPolitique.com</title>
    <meta name="description" content="Contactez-nous pour toute question ou suggestion concernant CasierPolitique.com">
    
    <!-- Robots -->
    
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://www.casierpolitique.com/contact">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico">
    <link rel="shortcut icon" type="image/x-icon" href="/static/img/favicon.ico">
    <link rel="apple-touch-icon" href="/static/img/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/img/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/img/favicon.ico">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.casierpolitique.com/contact">
    <meta property="og:title" content="CasierPolitique.com">
    <meta property="og:description" content="Casier politique des personnalit√©s et th√®mes politiques fran√ßais">
    <meta property="og:image" content="https://www.casierpolitique.com/static/img/logo.png">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://www.casierpolitique.com/contact">
    <meta property="twitter:title" content="CasierPolitique.com">
    <meta property="twitter:description" content="Casier politique des personnalit√©s et th√®mes politiques fran√ßais">
    <meta property="twitter:image" content="https://www.casierpolitique.com/static/img/logo.png">
    
    <!-- CSS optimis√© pour √©viter le layout shift -->
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <header>
        <div class="header-content">
            <div class="site-title">
                <a href="/">
                    <img src="/static/img/logo.webp" alt="Logo Casier Politique" style="height: 64px; width: 64px; vertical-align: middle;" decoding="async" loading="eager">
                    Casier Politique
                </a>
            </div>
        </div>
        <nav>
            <div class="nav-container">
                <a href="/" >Accueil</a>
                <a href="/profil/" >Profils</a>
                <a href="/sujet/" >Sujets</a>
                <a href="https://x.com/CasierPolitique" target="_blank" rel="noopener noreferrer">Suivez-nous sur X</a>
            </div>
        </nav>
    </header>

    <main>
        
<div class="profil">
    <h1>Contact</h1>
    <div class="content">
        <p>Vous avez une question, une suggestion ou vous souhaitez nous faire part d'une information ? 
            N'h√©sitez pas √† nous contacter en utilisant le formulaire ci-dessous.</p>
        <h2>Comment contribuer ?</h2>
        <p>Envoyez nous vos suggestions par le formulaire ci-dessous.</p>
        <ul>
            <li>Incluez un r√©sum√© du contenu que vous souhaitez ajouter.</li>
            <li>Ajoutez un lien vers une source cr√©dible.</li>
            <li>Pour faciliter le travail d'√©dition et mod√©ration, formulez votre suggestion pour qu'elle soit pr√™te √† publier telle quelle, si possible.</li>
        </ul>
        
        
        
        <form class="contact-form" id="contactForm">
            <!-- Champ cach√© pour d√©tecter les bots -->
            <div class="form-group" style="display: none !important; position: absolute !important; left: -9999px !important;">
                <label for="website">Site web :</label>
                <input type="text" id="website" name="website" autocomplete="off" tabindex="-1">
            </div>
            
            <div class="form-group">
                <label for="page">Page concern√©e :</label>
                <input type="text" id="page" name="page" placeholder="Ex: /profil/emmanuel-macron ou /sujet/jeux-olympiques-paris">
            </div>
            
            <div class="form-group">
                <label for="message">Votre message :</label>
                <textarea id="message" name="message" rows="6" placeholder="D√©crivez votre question, suggestion ou information..." required></textarea>
            </div>
            
            <!-- Altcha Captcha -->
            <div class="form-group">
                <altcha-widget 
                    id="captcha"
                    challengeurl="https://regal-nasturtium-30b87d.netlify.app/.netlify/functions/altcha"
                    theme="light"
                    lang="fr">
                </altcha-widget>
            </div>
            
            <button type="submit" class="btn-submit" id="submitBtn">Envoyer le message</button>
            
            <div id="formMessage" class="form-message" style="display: none;"></div>
        </form>
        
    </div>
</div>

<!-- Altcha Captcha - Charg√© uniquement sur cette page -->
<script
  async
  defer
  src="https://cdn.jsdelivr.net/gh/altcha-org/altcha@main/dist/altcha.min.js"
  type="module"
></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('contactForm');
    const submitBtn = document.getElementById('submitBtn');
    const formMessage = document.getElementById('formMessage');
    const captcha = document.getElementById('captcha');
    
    // Variable pour tracker l'√©tat du widget
    let altchaReady = false;
    
    // Fonction pour v√©rifier si le widget est pr√™t
    function checkAltchaReady() {
        if (captcha && captcha.shadowRoot) {
            console.log('‚úÖ Widget Altcha charg√©');
            altchaReady = true;
        } else {
            console.log('‚è≥ Widget Altcha en cours de chargement...');
            setTimeout(checkAltchaReady, 500);
        }
    }
    
    // Fonction pour attendre que le widget soit pr√™t (avec timeout)
    function waitForAltchaReady() {
        return new Promise((resolve) => {
            let attempts = 0;
            const maxAttempts = 50; // 5 secondes max
            
            const check = () => {
                attempts++;
                if (captcha && captcha.shadowRoot) {
                    console.log('‚úÖ Widget Altcha pr√™t pour la soumission');
                    resolve(true);
                } else if (attempts >= maxAttempts) {
                    console.log('‚ö†Ô∏è Timeout: Widget Altcha non charg√©, continuation sans captcha');
                    resolve(false);
                } else {
                    setTimeout(check, 100);
                }
            };
            check();
        });
    }
    
    // Commencer √† v√©rifier le widget
    checkAltchaReady();
    
    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // D√©sactiver imm√©diatement le bouton pour √©viter les clics multiples
        submitBtn.disabled = true;
        submitBtn.textContent = 'Envoi en cours...';
        
        console.log('üöÄ D√©but de soumission du formulaire');
        
        // Attendre que le widget Altcha soit pr√™t (avec timeout)
        const widgetReady = await waitForAltchaReady();
        
        console.log('üîç √âtat du formulaire:', {
            formExists: !!form,
            submitBtnExists: !!submitBtn,
            captchaExists: !!captcha,
            altchaReady: altchaReady,
            widgetReady: widgetReady
        });
        
        // R√©cup√©rer les donn√©es du formulaire
        const page = document.getElementById('page').value;
        const message = document.getElementById('message').value;
        const website = document.getElementById('website').value;
        
        console.log('üìù Donn√©es du formulaire:', { page, message, websiteFilled: !!website });
        
        // Validation du champ cach√© (d√©tection de bot)
        if (website.trim()) {
            console.log('üö´ Bot d√©tect√©');
            showMessage('Erreur de validation', 'error');
            return;
        }
        
        // Validation du message
        if (!message.trim()) {
            console.log('‚ùå Validation √©chou√©e: message vide');
            showMessage('Le message est requis', 'error');
            return;
        }
        
        // Validation du captcha
        let captchaToken = null;
        
        // Essayer plusieurs m√©thodes pour r√©cup√©rer le token
        if (captcha) {
            // M√©thode 1: Attributs directs
            captchaToken = captcha.getAttribute('token') || 
                          captcha.getAttribute('altcha') ||
                          captcha.value;
            
            // M√©thode 2: Shadow DOM
            if (!captchaToken && captcha.shadowRoot) {
                const hiddenInput = captcha.shadowRoot.querySelector('input[type="hidden"]');
                if (hiddenInput) {
                    captchaToken = hiddenInput.value;
                }
            }
            
            // M√©thode 3: Propri√©t√© du widget
            if (!captchaToken && captcha.token) {
                captchaToken = captcha.token;
            }
        }
        
        // M√©thode 4: Chercher dans le formulaire
        if (!captchaToken) {
            const formInputs = form.querySelectorAll('input[type="hidden"]');
            for (let input of formInputs) {
                if (input.name === 'altcha' || input.name === 'captcha' || input.name === 'token') {
                    captchaToken = input.value;
                    break;
                }
            }
        }
        
        // M√©thode 5: Chercher par nom d'attribut
        if (!captchaToken) {
            const altchaInput = form.querySelector('input[name="altcha"]');
            if (altchaInput) {
                captchaToken = altchaInput.value;
            }
        }
        
        console.log('üîç √âtat du captcha:', {
            hasToken: !!captchaToken,
            token: captchaToken,
            captchaExists: !!captcha,
            attributes: captcha ? captcha.getAttributeNames() : [],
            hasShadowRoot: captcha ? !!captcha.shadowRoot : false,
            shadowRootChildren: captcha && captcha.shadowRoot ? captcha.shadowRoot.children.length : 0,
            formInputs: form.querySelectorAll('input').length,
            hiddenInputs: form.querySelectorAll('input[type="hidden"]').length
        });
        
        if (!captchaToken) {
            console.log('‚ùå Validation √©chou√©e: captcha non r√©solu');
            showMessage('Veuillez compl√©ter le captcha', 'error');
            return;
        }
        
        console.log('‚úÖ Captcha valid√©');
        console.log('‚úÖ Validation r√©ussie');
        
        // Masquer les messages pr√©c√©dents
        hideMessage();
        
        const requestData = {
            page: page,
            message: message,
            captchaToken: captchaToken,
            website: website
        };
        
        console.log('üì§ Donn√©es √† envoyer:', requestData);
        console.log('üåê URL de destination: https://regal-nasturtium-30b87d.netlify.app/.netlify/functions/contact');
        
        try {
            console.log('üîÑ Envoi de la requ√™te...');
            
            // Envoyer vers l'API Netlify
            const response = await fetch('https://regal-nasturtium-30b87d.netlify.app/.netlify/functions/contact', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestData)
            });
            
            console.log('üì• R√©ponse re√ßue:', {
                status: response.status,
                statusText: response.statusText,
                ok: response.ok,
                headers: Object.fromEntries(response.headers.entries())
            });
            
            const data = await response.json();
            console.log('üìÑ Donn√©es de r√©ponse:', data);
            
            if (response.ok && data.success) {
                console.log('‚úÖ Succ√®s!');
                showMessage('Votre message a √©t√© envoy√© avec succ√®s !', 'success');
                form.reset();
                // R√©initialiser le captcha
                if (captcha) {
                    captcha.removeAttribute('token');
                }
            } else {
                console.log('‚ùå Erreur dans la r√©ponse:', data.error);
                showMessage(data.error || 'Une erreur est survenue', 'error');
            }
            
        } catch (error) {
            console.error('üí• Erreur de connexion:', error);
            console.error('üí• Type d\'erreur:', error.name);
            console.error('üí• Message d\'erreur:', error.message);
            console.error('üí• Stack trace:', error.stack);
            showMessage('Erreur de connexion. Veuillez r√©essayer.', 'error');
        } finally {
            console.log('üèÅ Fin de traitement');
            // R√©activer le bouton
            submitBtn.disabled = false;
            submitBtn.textContent = 'Envoyer le message';
        }
    });
    
    function showMessage(text, type) {
        formMessage.textContent = text;
        formMessage.className = `form-message ${type}`;
        formMessage.style.display = 'block';
        
        // Scroll vers le message
        formMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
    
    function hideMessage() {
        formMessage.style.display = 'none';
    }
});
</script>

    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-links">
                <a href="/mentions-legales">Mentions l√©gales</a>
                <a href="/contact">Contact</a>
            </div>
            <div class="footer-copyright">
                &copy; 2025 CasierPolitique.com
            </div>
            <div class="footer-update">
                Derni√®re mise √† jour : 9 septembre 2025
            </div>
        </div>
    </footer>

    <!-- Scripts optimis√©s pour le rendu -->
    <script src="/static/js/redirect.js" defer></script>
    <script src="/static/js/search-suggestions.js" defer></script>
    
    
</body>
</html> 